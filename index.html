<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A friendly MCMC framework • fmcmc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A friendly MCMC framework">
<meta property="og:description" content="Provides a friendly (flexible) Markov Chain Monte Carlo (MCMC)
         framework for implementing Metropolis-Hastings algorithm in a modular way
         allowing users to specify automatic convergence checker, personalized
         transition kernels, and out-of-the-box multiple MCMC chains using
         parallel computing. Most of the methods implemented in this package can
         be found in Brooks et al. (2011, ISBN 9781420079425). Among the methods
         included, we have: Haario (2001) &lt;doi:10.1007/s11222-011-9269-5&gt;
         Adaptive Metropolis, Vihola (2012) &lt;doi:10.1007/s11222-011-9269-5&gt;
         Robust Adaptive Metropolis, and Thawornwattana et
         al. (2018) &lt;doi:10.1214/17-BA1084&gt; Mirror transition kernels.">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-108627422-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-108627422-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">fmcmc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/user-defined-kernels.html">User-defined kernels</a>
    </li>
    <li>
      <a href="articles/workflow-with-fmcmc.html">Workflow with fmcmc</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USCbiostats/fmcmc/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="fmcmc-a-friendly-mcmc-framework" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#fmcmc-a-friendly-mcmc-framework" class="anchor"></a>fmcmc: A friendly MCMC framework <img src="reference/figures/logo.png" align="right" height="140">
</h1></div>

<div id="what" class="section level2">
<h2 class="hasAnchor">
<a href="#what" class="anchor"></a>What</h2>
<p>The <code>fmcmc</code> R package provides a lightweight general framework for implementing Markov Chain Monte Carlo methods based on the Metropolis-Hastings algorithm. This implementation’s main purpose lies in the fact that the user can incorporate the following in a flexible way:</p>
<ol>
<li><p><strong>Automatic convergence checker</strong>: The algorithm splits the MCMC runs according to the frequency with which it needs to check convergence. Users can use either one of the included functions (<code>convergence_gelman</code>, <code>convergence_geweke</code>, etc.), or provide their own.</p></li>
<li><p><strong>Run multiple chains in parallel fashion</strong>: Using either a <code>PSOCK</code> cluster (default), or providing a personalized cluster object like the ones in the <code>parallel</code> R package.</p></li>
<li><p><strong>User defined transition kernels</strong>: Besides of canonical Gaussian Kernel, users can specify their own or use one of the included in the package, for example: <code>kernel_adapt</code>, <code>kernel_ram</code>, <code>kernel_normal_reflective</code>, <code>kernel_unif</code>, <code>kernel_mirror</code>, or <code>kernel_unif_reflective</code>.</p></li>
</ol>
<p>All the above without requiring compiled code.</p>
</div>
<div id="who-is-this-for" class="section level2">
<h2 class="hasAnchor">
<a href="#who-is-this-for" class="anchor"></a>Who is this for?</h2>
<p>While a lot of users rely on MCMC tools such as Stan (via the <a href="https://cran.r-project.org/package=rstan">rstan</a> package) or WinBUGS (via <a href="https://cran.r-project.org/package=R2WinBUGS">rstan</a>), in several settings either these tools are not enough or provide too much for things that do not need that much. So, this tool is for you if:</p>
<ul>
<li><p>You have a simple model to estimate with Metropolis-Hastings.</p></li>
<li><p>You want to run multiple chains of your model using out-of-the-box parallel computing.</p></li>
<li><p>You don’t want (or cannot) rely on external tools (so you just need good-old base R only for your models).</p></li>
<li><p>You want to implement a model in which your model parameters are either bounded (like a standard error, for example), or are not, say, continuous (e.g., a size variable in a Binomial distribution), so you need your own transition kernel.</p></li>
</ul>
<p>In any other case, you may want to take a look at the previously mentioned R packages, or check out the <a href="https://cran.r-project.org/package=mcmc">mcmc</a> R package, which also implements the Metropolis-Hastings algorithm (although with not all the features that this R package has), the <a href="https://cran.r-project.org/package=adaptMCMC">adaptMCMC</a> R package, or the <a href="https://cran.r-project.org/package=MCMCpack">MCMCpack</a> R package.</p>
</div>
</div>
<div id="installing" class="section level1">
<h1 class="hasAnchor">
<a href="#installing" class="anchor"></a>Installing</h1>
<p>If you want to get the latest bleeding-edge version from Github, you can use <a href="https://cran.r-project.org/package=devtools">devtools</a>:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"USCbiostats/fmcmc"</span>)</pre></div>
<p>The latest (stable) release is also available on CRAN:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"fmcmc"</span>)</pre></div>
</div>
<div id="citation" class="section level1">
<h1 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h1>
<pre><code>
To cite fmcmc in publications use:

  Vega Yon et al., (2019). fmcmc: A friendly MCMC framework. Journal of
  Open Source Software, 4(39), 1427,
  https://doi.org/10.21105/joss.01427

A BibTeX entry for LaTeX users is

  @Article{,
    title = {fmcmc: A friendly MCMC framework},
    author = {George {Vega Yon} and Paul Marjoram},
    journal = {The Journal of Open Source Software},
    year = {2019},
    month = {jul},
    volume = {4},
    number = {39},
    doi = {10.21105/joss.01427},
    url = {https://doi.org/10.21105/joss.01427},
  }</code></pre>
</div>
<div id="example-linear-regression-model" class="section level1">
<h1 class="hasAnchor">
<a href="#example-linear-regression-model" class="anchor"></a>Example: Linear regression model</h1>
<div id="first-run" class="section level2">
<h2 class="hasAnchor">
<a href="#first-run" class="anchor"></a>First run</h2>
<p>In the following we show how to use the package for estimating parameters in a linear regression model. First, let’s simulate some data to use:</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">78845</span>)
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">1000</span>
<span class="no">X</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fl">3.0</span> + <span class="fl">2.0</span>*<span class="no">X</span> + <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fl">4</span>)</pre></div>
<p>As you can see, in this case we have three parameters to estimate, the constant (2.0), the <span class="math inline"><em>β</em></span> coefficient (2.0), and the standard deviation parameter of the error (1.5).</p>
<p>To estimate this model, we can either maximize the log-likelihood function–which is what is usually done–or we could do it using MCMC. In either case, we need to specify the log(unnormalized some times)-likelihood function:</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="no">ll</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">p</span>, <span class="no">X.</span>, <span class="no">y.</span>) {

  <span class="no">joint_ll</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="no">y.</span> - (<span class="no">p</span>[<span class="fl">1</span>] + <span class="no">X.</span>*<span class="no">p</span>[<span class="fl">2</span>]), <span class="kw">sd</span> <span class="kw">=</span> <span class="no">p</span>[<span class="fl">3</span>], <span class="kw">log</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  <span class="no">joint_ll</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">joint_ll</span>)

  <span class="co"># If is undefined, then we explicitly return infinte (instead of NaN, for</span>
  <span class="co"># example)</span>
  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.finite</a></span>(<span class="no">joint_ll</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(-<span class="fl">Inf</span>)

  <span class="no">joint_ll</span>
}</pre></div>
<p>Notice that the function has more than 1 argument, in this case, <code>p</code>, which is the vector of parameters, <code>X.</code> and <code>y.</code>, which hold the data of our model.</p>
<p>Let’s do a first run of the MCMC algorithm using the function of the same name (first, load the package, of course):</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fmcmc</span>)

<span class="co"># Running the MCMC (we set the seed first)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1215</span>)
<span class="no">ans</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/MCMC.html">MCMC</a></span>(
  <span class="no">ll</span>,
  <span class="kw">initial</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">y</span>)),
  <span class="kw">nsteps</span>  <span class="kw">=</span> <span class="fl">5000</span>,
  <span class="kw">X.</span>      <span class="kw">=</span> <span class="no">X</span>,
  <span class="kw">y.</span>      <span class="kw">=</span> <span class="no">y</span>
  )</pre></div>
<p>As the output object is an object of class <code>mcmc</code> from the <code>coda</code> R package, we can use all the functions from it on our output:</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">coda</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ans</span>)</pre></div>
<p><img src="reference/figures/first-diagnostics-1.png"><!-- --></p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ans</span>)</pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">## </a>
<a class="sourceLine" id="cb9-2" data-line-number="2">## Iterations = 1:5000</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">## Thinning interval = 1 </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">## Number of chains = 1 </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">## Sample size per chain = 5000 </a>
<a class="sourceLine" id="cb9-6" data-line-number="6">## </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">## 1. Empirical mean and standard deviation for each variable,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">##    plus standard error of the mean:</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">## </a>
<a class="sourceLine" id="cb9-10" data-line-number="10">##       Mean     SD Naive SE Time-series SE</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">## par1 3.126 0.1893 0.002677        0.03128</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">## par2 1.943 0.1234 0.001746        0.04176</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">## par3 4.093 0.0930 0.001315        0.01168</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">## </a>
<a class="sourceLine" id="cb9-15" data-line-number="15">## 2. Quantiles for each variable:</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">## </a>
<a class="sourceLine" id="cb9-17" data-line-number="17">##       2.5%   25%   50%   75% 97.5%</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">## par1 2.951 3.013 3.112 3.172 3.511</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">## par2 1.763 1.892 1.956 2.026 2.171</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">## par3 3.979 4.064 4.106 4.134 4.186</a></code></pre></div>
<p>While the summary statistics look very good (we got very close to the original parameters), the trace of the parameters looks vary bad (poor mixing). We can re-run the algorithm changing the scale parameter in the <code>kernel_normal</code> function. In order to do so, we can simply pass <code>ans</code> as the <code>initial</code> argument so that the function starts from the last point of that chain:</p>
<div class="sourceCode" id="cb10"><pre class="r"><span class="no">ans</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/MCMC.html">MCMC</a></span>(
  <span class="no">ll</span>,
  <span class="kw">initial</span> <span class="kw">=</span> <span class="no">ans</span>,
  <span class="kw">nsteps</span>  <span class="kw">=</span> <span class="fl">5000</span>,
  <span class="kw">X.</span>      <span class="kw">=</span> <span class="no">X</span>,
  <span class="kw">y.</span>      <span class="kw">=</span> <span class="no">y</span>,
  <span class="kw">kernel</span>  <span class="kw">=</span> <span class="fu"><a href="reference/kernel_normal.html">kernel_normal</a></span>(<span class="kw">scale</span> <span class="kw">=</span> <span class="fl">.05</span>) <span class="co"># We can set the scale parameter like this</span>
  )
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ans</span>)</pre></div>
<p><img src="reference/figures/summary-and-plot1-1.png"><!-- --></p>
<p>Much better! Now, what if we use Vihola (2012) Robust Adaptive Metropolis (which is also implemented in the R package <a href="https://cran.r-project.org/package=adaptMCMC">adaptMCMC</a>)</p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="no">ans_RAM</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/MCMC.html">MCMC</a></span>(
  <span class="no">ll</span>,
  <span class="kw">initial</span> <span class="kw">=</span> <span class="no">ans</span>,
  <span class="kw">nsteps</span>  <span class="kw">=</span> <span class="fl">5000</span>,
  <span class="kw">X.</span>      <span class="kw">=</span> <span class="no">X</span>,
  <span class="kw">y.</span>      <span class="kw">=</span> <span class="no">y</span>,
  <span class="kw">kernel</span>  <span class="kw">=</span> <span class="fu"><a href="reference/kernel_ram.html">kernel_ram</a></span>()
  )
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ans_RAM</span>)</pre></div>
<p><img src="reference/figures/summary-and-plot-ram-1.png"><!-- --></p>
<div class="sourceCode" id="cb12"><pre class="r"><span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/pkg/coda/man/rejectionRate.html">rejectionRate</a></span>(<span class="no">ans_RAM</span>)</pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">##      par1      par2      par3 </a>
<a class="sourceLine" id="cb13-2" data-line-number="2">## 0.3486697 0.3486697 0.3486697</a></code></pre></div>
<p>We can also try using Haario et al (2001) Adaptive Metropolis</p>
<div class="sourceCode" id="cb14"><pre class="r"><span class="no">ans_AM</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/MCMC.html">MCMC</a></span>(
  <span class="no">ll</span>,
  <span class="kw">initial</span> <span class="kw">=</span> <span class="no">ans</span>,
  <span class="kw">nsteps</span>  <span class="kw">=</span> <span class="fl">5000</span>,
  <span class="kw">X.</span>      <span class="kw">=</span> <span class="no">X</span>,
  <span class="kw">y.</span>      <span class="kw">=</span> <span class="no">y</span>,
  <span class="kw">kernel</span>  <span class="kw">=</span> <span class="fu"><a href="reference/kernel_adapt.html">kernel_adapt</a></span>()
  )
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ans_AM</span>)</pre></div>
<p><img src="reference/figures/summary-and-plot-adapt-1.png"><!-- --></p>
<div class="sourceCode" id="cb15"><pre class="r"><span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/pkg/coda/man/rejectionRate.html">rejectionRate</a></span>(<span class="no">ans_AM</span>)</pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">##      par1      par2      par3 </a>
<a class="sourceLine" id="cb16-2" data-line-number="2">## 0.5057011 0.5057011 0.5057011</a></code></pre></div>
</div>
<div id="automatic-stop" class="section level2">
<h2 class="hasAnchor">
<a href="#automatic-stop" class="anchor"></a>Automatic stop</h2>
<p>Now, suppose that the algorithm actually takes a lot of time to actually reach stationary state, then it would be nice to actually sample from the posterior distribution once convergence has been reached. In the following example we use multiple chains and the Gelman diagnostic to check for convergence of the chain:</p>
<div class="sourceCode" id="cb17"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1215</span>) <span class="co"># Same seed as before</span>
<span class="no">ans</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/MCMC.html">MCMC</a></span>(
  <span class="no">ll</span>,
  <span class="kw">initial</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">y</span>)),
  <span class="kw">nsteps</span>  <span class="kw">=</span> <span class="fl">5000</span>,
  <span class="kw">X.</span>      <span class="kw">=</span> <span class="no">X</span>,
  <span class="kw">y.</span>      <span class="kw">=</span> <span class="no">y</span>,
  <span class="kw">kernel</span>  <span class="kw">=</span> <span class="fu"><a href="reference/kernel_normal.html">kernel_normal</a></span>(<span class="kw">scale</span> <span class="kw">=</span> <span class="fl">.05</span>),
  <span class="kw">nchains</span> <span class="kw">=</span> <span class="fl">2</span>,                           <span class="co"># Multiple chains</span>
  <span class="kw">conv_checker</span> <span class="kw">=</span> <span class="fu"><a href="reference/convergence-checker.html">convergence_gelman</a></span>(<span class="fl">50</span>) <span class="co"># Checking for conv. every 200 steps</span>
  )</pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">## No convergence yet (steps count: 50). Trying with the next bulk.</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">## Convergence has been reached with 100 steps (100 final count of samples).</a></code></pre></div>
<p>As a difference from the previous case, now we didn’t had to wait until the 5,000 steps were done, but the algorithm stopped for us, allowing us to start generating the desired sample much quicker.</p>
</div>
<div id="kernels-making-sure-that-we-get-positive-values" class="section level2">
<h2 class="hasAnchor">
<a href="#kernels-making-sure-that-we-get-positive-values" class="anchor"></a>Kernels: Making sure that we get positive values</h2>
<p>For this final example, we will use the <code>kernel</code> argument and provide what corresponds to a transition kernel which makes proposals within certain boundaries, in particular, we want the algorithm to propose only positive values for the <code>sd</code> parameter, which we now must be positive.</p>
<p>More over, since we now from a fact that we will only get positive values, we can go further and modify <code>ll</code> skipping the check for finite values:</p>
<div class="sourceCode" id="cb19"><pre class="r"><span class="no">ll</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">p</span>, <span class="no">X.</span>, <span class="no">y.</span>) {

  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="no">y.</span> - (<span class="no">p</span>[<span class="fl">1</span>] + <span class="no">X.</span>*<span class="no">p</span>[<span class="fl">2</span>]), <span class="kw">sd</span> <span class="kw">=</span> <span class="no">p</span>[<span class="fl">3</span>], <span class="kw">log</span> <span class="kw">=</span> <span class="fl">TRUE</span>))

}</pre></div>
<p>Much simpler function! Let’s do the call of the MCMC function specifying the right transition kernel to increase the acceptance rate. In this example, we will set the max of all parameters to be 5.0, and the min to be -5.0 for the constant and 0 for the beta coefficient and the variance parameter, all this using the <code>kernel_normal_reflective</code> (which implements a normal kernel with boundaries) function:</p>
<div class="sourceCode" id="cb20"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1215</span>) <span class="co"># Same seed as before</span>
<span class="no">ans</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/MCMC.html">MCMC</a></span>(
  <span class="no">ll</span>,
  <span class="kw">initial</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">y</span>)),
  <span class="kw">nsteps</span>  <span class="kw">=</span> <span class="fl">5000</span>,
  <span class="kw">X.</span>      <span class="kw">=</span> <span class="no">X</span>,
  <span class="kw">y.</span>      <span class="kw">=</span> <span class="no">y</span>,
  <span class="kw">kernel</span>  <span class="kw">=</span> <span class="fu"><a href="reference/kernel_normal.html">kernel_normal_reflective</a></span>(
    <span class="kw">ub</span>    <span class="kw">=</span> <span class="fl">5.0</span>,               <span class="co"># All parameters have the same upper bound</span>
    <span class="kw">lb</span>    <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>), <span class="co"># But lower bound is specified per parameter</span>
    <span class="kw">scale</span> <span class="kw">=</span> <span class="fl">0.05</span>               <span class="co"># This is the same scale as before</span>
    ),
  <span class="kw">nchains</span> <span class="kw">=</span> <span class="fl">2</span>,
  <span class="kw">conv_checker</span> <span class="kw">=</span> <span class="fu"><a href="reference/convergence-checker.html">convergence_gelman</a></span>(<span class="fl">50</span>)
  )</pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">## No convergence yet (steps count: 50). Trying with the next bulk.</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">## Convergence has been reached with 100 steps (100 final count of samples).</a></code></pre></div>
<p>Again, as the proposal kernel has lower and upper bounds, then we are guaranteed that all proposed states are within the support of the parameter space.</p>
</div>
</div>
<div id="other-tools" class="section level1">
<h1 class="hasAnchor">
<a href="#other-tools" class="anchor"></a>Other tools</h1>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/mcmc/mcmc.pdf" class="uri">https://cran.r-project.org/web/packages/mcmc/mcmc.pdf</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/HybridMC/HybridMC.pdf" class="uri">https://cran.r-project.org/web/packages/HybridMC/HybridMC.pdf</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/adaptMCMC/adaptMCMC.pdf" class="uri">https://cran.r-project.org/web/packages/adaptMCMC/adaptMCMC.pdf</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/elhmc/elhmc.pdf" class="uri">https://cran.r-project.org/web/packages/elhmc/elhmc.pdf</a></p></li>
</ul>
</div>
<div id="contributing-to-fmcmc" class="section level1">
<h1 class="hasAnchor">
<a href="#contributing-to-fmcmc" class="anchor"></a>Contributing to <code>fmcmc</code>
</h1>
<p>We welcome contributions to <code>fmcmc</code>. Whether it is reporting a bug, starting a discussion by asking a question, or proposing/requesting a new feature, please go by creating a new issue <a href="https://github.com/USCbiostats/fmcmc/issues">here</a> so that we can talk about it.</p>
<p>Please note that the ‘fmcmc’ project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
<div id="funding" class="section level1">
<h1 class="hasAnchor">
<a href="#funding" class="anchor"></a>Funding</h1>
<p>Supported by National Cancer Institute Grant #1P01CA196596.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=fmcmc">https://​cloud.r-project.org/​package=fmcmc</a>
</li>
<li>Browse source code at <br><a href="https://github.com/USCbiostats/fmcmc/">https://​github.com/​USCbiostats/​fmcmc/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/USCbiostats/fmcmc/issues">https://​github.com/​USCbiostats/​fmcmc/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing fmcmc</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>George Vega Yon <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3171-0844" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>National
         Cancer Institute (NCI) <br><small class="roles"> Funder </small>  <br><small>(Grant Number
         5P01CA196569-02)</small>
</li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://doi.org/10.21105/joss.01427"><img src="http://joss.theoj.org/papers/10.21105/joss.01427/status.svg" alt="DOI"></a></li>
<li><a href="https://travis-ci.org/USCbiostats/fmcmc"><img src="https://travis-ci.org/USCbiostats/fmcmc.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/gvegayon/fmcmc/branch/master"><img src="https://ci.appveyor.com/api/projects/status/lirawn11ssw9cq07/branch/master?svg=true" alt="Build status"></a></li>
<li><a href="https://codecov.io/github/USCbiostats/fmcmc?branch=master"><img src="https://img.shields.io/codecov/c/github/USCbiostats/fmcmc/master.svg" alt="Coverage Status"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#stable"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://cran.r-project.org/package=fmcmc"><img src="https://www.r-pkg.org/badges/version/fmcmc" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=fmcmc"><img src="http://cranlogs.r-pkg.org/badges/grand-total/fmcmc" alt="CRAN downloads"></a></li>
<li><a href="https://CRAN.R-project.org/package=fmcmc"><img src="https://tinyverse.netlify.com/badge/fmcmc" alt="status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by George Vega Yon, National
         Cancer Institute (NCI).</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
